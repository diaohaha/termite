webpackJsonp([2],{"59s4":function(e,t){},BUHG:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("gyMJ"),r=a("mvHQ"),n=a.n(r),s={name:"WorkDetailComponent",data:function(){return{form:{work_name:"",work_key:"",work_desc:"",config:""},options:{mode:"code",indentation:4,search:!0},config_editor:null}},props:["form"],methods:{reinit:function(){console.log("WorkDetailComponent Reinit."),this.form.work_name="",this.form.work_desc="",this.form.work_key="",this.form.config={},this.initJsonEditor()},refresh:function(){this.form.config=n()(this.config_editor.get())},initJsonEditor:function(){var e=document.getElementById("config_editor");e.innerHTML="",this.config_editor=new this.$jsoneditor(e,this.options),this.config_editor.set(this.form.config)}},created:function(){var e=this;this.$nextTick(function(){e.reinit()})}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"form-box"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"工作key"}},[a("el-input",{model:{value:e.form.work_key,callback:function(t){e.$set(e.form,"work_key",t)},expression:"form.work_key"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"工作名称"}},[a("el-input",{model:{value:e.form.work_name,callback:function(t){e.$set(e.form,"work_name",t)},expression:"form.work_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:e.form.work_desc,callback:function(t){e.$set(e.form,"work_desc",t)},expression:"form.work_desc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"工作配置"}},[a("div",{attrs:{id:"config_editor"}})])],1)],1)},staticRenderFns:[]},l={name:"iflows",components:{WorkDetailComponent:a("VU/8")(s,i,!1,null,null,null).exports},data:function(){return{query:{search:"",page_index:1,page_size:13},tableData:[],itemTotal:0,multipleSelection:[],delList:[],editVisible:!1,copyVisible:!1,createVisible:!1,copyParams:{src_work_key:"",work_key:""},deleteParams:{work_key:""},createParams:{work_name:"",work_key:"",work_desc:"",config:""},form:{},idx:-1}},created:function(){this.getData()},methods:{getData:function(){var e=this;Object(o.q)(this.query).then(function(t){e.tableData=t.data.configs,e.itemTotal=t.data.count})},jump:function(e){this.$router.push("iworks/"+e)},handleCreate:function(){this.createVisible=!0},handleDelete:function(e,t){var a=this;this.deleteParams.work_key=t.key,this.$confirm("确定要删除吗？","提示",{type:"warning"}).then(function(){Object(o.i)(a.deleteParams).then(function(t){"A0001"==t.code?(a.$message.success("删除成功"),a.tableData.splice(e,1)):a.$message.error(t.msg)})}).catch(function(){})},handleSelectionChange:function(e){this.multipleSelection=e},delAllSelection:function(){var e=this.multipleSelection.length,t="";this.delList=this.delList.concat(this.multipleSelection);for(var a=0;a<e;a++)t+=this.multipleSelection[a].name+" ";this.$message.error("删除了"+t),this.multipleSelection=[]},handleEdit:function(e,t){console.log("edit",e,t),this.idx=e,this.form=t,this.editVisible=!0},handleCopy:function(e,t){this.copyParams.work_key=t.key,this.copyParams.src_work_key=t.key,this.copyVisible=!0},saveCreate:function(){var e=this;this.$refs.workdetail.refresh(),this.createVisible=!1,Object(o.f)(this.createParams).then(function(t){"A0001"==t.code?e.$message.success("创建成功"):e.$message.error("创建失败"),e.getData()})},saveCopy:function(){var e=this;Object(o.d)(this.copyParams).then(function(t){"A0001"==t.code?(e.$message.success("复制成功"),e.getData()):e.$message.error(t.msg)}),this.copyVisible=!1},handlePageChange:function(e){this.$set(this.query,"page_index",e),this.getData()},handleSearch:function(){this.$set(this.query,"page_index",1),this.getData()}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"work key"},model:{value:e.query.search,callback:function(t){e.$set(e.query,"search",t)},expression:"query.search"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("search")]),e._v(" "),a("el-button",{staticClass:"handle-add mr10",staticStyle:{float:"right"},attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:e.handleCreate}},[e._v("create")])],1),e._v(" "),a("el-table",{ref:"worksTable",staticClass:"table",attrs:{data:e.tableData,border:"","header-cell-class-name":"table-header"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"Key",label:"key"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){return e.jump(t.row.key)}}},[e._v(e._s(t.row.key))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"name"}}),e._v(" "),a("el-table-column",{attrs:{prop:"desc",label:"desc"}}),e._v(" "),a("el-table-column",{attrs:{label:"operation",width:"180",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",icon:"el-icon-copy-document"},on:{click:function(a){return e.handleCopy(t.$index,t.row)}}},[e._v("copy")]),e._v(" "),a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("delete")])]}}])})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.query.page_index,"page-size":e.query.page_size,total:e.itemTotal},on:{"current-change":e.handlePageChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"创建",visible:e.createVisible},on:{"update:visible":function(t){e.createVisible=t}}},[a("WorkDetailComponent",{ref:"workdetail",attrs:{form:e.createParams}}),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.createVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveCreate}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"复制",visible:e.copyVisible,width:"30%"},on:{"update:visible":function(t){e.copyVisible=t}}},[a("el-form",{ref:"copyParams",attrs:{model:e.copyParams,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"key"}},[a("el-input",{model:{value:e.copyParams.work_key,callback:function(t){e.$set(e.copyParams,"work_key",t)},expression:"copyParams.work_key"}})],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.copyVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.saveCopy}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var d=a("VU/8")(l,c,!1,function(e){a("xCYC")},"data-v-26f90d1f",null);t.default=d.exports},enD8:function(e,t){},w7KR:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("mvHQ"),r=a.n(o),n=a("gyMJ"),s={name:"workDetail",data:function(){return{workData:{},query:{work_key:this.$route.params.workKey},form:{work_name:"",work_key:"",work_desc:"",config:""},options:{mode:"code",indentation:4,search:!0},config_editor:null}},methods:{getWorkDetailData:function(){var e=this;Object(n.m)(this.query).then(function(t){if(e.workData=t.data[0],console.log("work Data: ",e.workData),e.workData){e.form.work_key=e.workData.key,e.form.work_name=e.workData.name,e.form.work_desc=e.workData.desc;var a=document.getElementById("config_editor");e.config_editor=new e.$jsoneditor(a,e.options),e.config_editor.set(e.workData.config)}})},onSubmit:function(){var e=this;this.form.config=r()(this.config_editor.get()),Object(n.v)(this.form).then(function(t){"A0001"==t.code?e.$message.success("更新成功！"):e.$message.error(t.msg)})}},created:function(){this.getWorkDetailData()}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"form-box"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"工作key"}},[a("el-input",{attrs:{disabled:!0},model:{value:e.form.work_key,callback:function(t){e.$set(e.form,"work_key",t)},expression:"form.work_key"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"工作名称"}},[a("el-input",{model:{value:e.form.work_name,callback:function(t){e.$set(e.form,"work_name",t)},expression:"form.work_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:e.form.work_desc,callback:function(t){e.$set(e.form,"work_desc",t)},expression:"form.work_desc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"工作配置"}},[a("div",{staticStyle:{height:"500px"},attrs:{id:"config_editor"}})]),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("更新")])],1)],1)],1)},staticRenderFns:[]},l={name:"workInstance",data:function(){return{pageTotal:0,tableData:[],query:{cid:"",vwork:this.$route.params.workKey,page_index:1,page_size:15},expands:[]}},methods:{tableRowClassName:function(e){var t=e.row;e.rowIndex;return console.log("row is:",t),"超时"===t.state?"warning-row":"异常"===t.state?"failed-row":"失败"===t.state?"warning-row":"初始化"===t.state?"success-row":"已下发"===t.state?"success-row":"执行中"===t.state?"success-row":"成功"===t.state?"success-row":"延期调度"===t.state?"success-row":""},expandContext:function(e,t,a){Array.prototype.remove=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},this.expands=[],this.expands.indexOf(e.flow_id)<0?this.expands.push(e.flow_id):this.expands.remove(e.flow_id),this.expands.indexOf(e.flow_id)<0?this.expands.push(e.flow_id):this.expands.remove(e.flow_id)},getWorkInstanceData:function(){var e=this;console.log(this.$route.params.workkey),Object(n.l)(this.query).then(function(t){e.tableData=t.data.works,e.pageTotal=t.data.count})},handleSearch:function(){this.$set(this.query,"page_index",1),this.getWorkInstanceData()},handlePageChange:function(e){this.$set(this.query,"page_index",e),this.getWorkInstanceData()}},created:function(){this.getWorkInstanceData()}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-input",{staticClass:"handle-input",staticStyle:{width:"300px"},attrs:{placeholder:"cid"},model:{value:e.query.cid,callback:function(t){e.$set(e.query,"cid",t)},expression:"query.cid"}}),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.handleSearch}},[e._v("search")])],1),e._v(" "),a("br"),e._v(" "),a("el-table",{ref:"multipleTable",staticClass:"table",staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","row-class-name":e.tableRowClassName,"header-cell-class-name":"table-header","row-key":"work_id","expand-row-keys":e.expands},on:{"row-click":e.expandContext}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[e._v("创建时间:")])])]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[e._v(e._s(t.row.create_time))])])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[e._v("更新时间:")])])]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[e._v(e._s(t.row.update_time))])])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[e._v("对象ID:")])])]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[e._v(e._s(t.row.cid))])])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[e._v("任务名称:")])])]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[e._v(e._s(t.row.vwork))])])])],1),e._v(" "),a("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[e._v("任务输出:")])])]),e._v(" "),a("el-col",{attrs:{span:22}},[a("div",{staticClass:"grid-content bg-purple"},[a("pre",[e._v(e._s(t.row.output))])])])],1),e._v(" "),a("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[e._v("异常信息:")])])]),e._v(" "),a("el-col",{attrs:{span:22}},[a("div",{staticClass:"grid-content bg-purple"},[a("pre",[e._v(e._s(t.row.error))])])])],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"work_id",label:"work_id"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"create_time"}}),e._v(" "),a("el-table-column",{attrs:{prop:"update_time",label:"update_time"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cid",label:"cid"}}),e._v(" "),a("el-table-column",{attrs:{prop:"state",label:"state"}})],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":e.query.page_index,"page-size":e.query.page_size,total:e.pageTotal},on:{"current-change":e.handlePageChange}})],1)],1)])},staticRenderFns:[]};var d={name:"Work",data:function(){return{active:0,currentType:"detail",currentView:"workDetail",tabs:[{type:"detail",view:"workDetail"},{type:"instance",view:"workInstance"}]}},methods:{toggle:function(e,t,a){console.log("toggle",e,t,a),this.active=e,this.currentView=t,this.currentType=a}},components:{workDetail:a("VU/8")(s,i,!1,null,null,null).exports,workInstance:a("VU/8")(l,c,!1,function(e){a("enD8")},null,null).exports}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"container"},[a("ul",{staticClass:"innertab"},e._l(e.tabs,function(t,o){return a("li",{staticClass:"innertab",class:{active:e.active==o},on:{click:function(a){return e.toggle(o,t.view,t.type)}}},[e._v("\n\t\t\t\t"+e._s(t.type)+"\n\t\t\t")])}),0),e._v(" "),a("hr"),e._v(" "),a(e.currentView,{tag:"component",staticStyle:{"padding-top":"20px"}})],1)])},staticRenderFns:[]};var p=a("VU/8")(d,u,!1,function(e){a("59s4")},null,null);t.default=p.exports},xCYC:function(e,t){}});
//# sourceMappingURL=2.8bbecb70edb25aa619f5.js.map