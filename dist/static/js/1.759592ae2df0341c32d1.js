webpackJsonp([1],{KGoD:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("mvHQ"),n=o.n(a),r=o("gyMJ"),s=(o("pFYg"),{name:"flowdetail",data:function(){return{flowData:{},query:{vflow:this.$route.params.flowKey},form:{flow_name:"",flow_key:"",flow_desc:"",env:"",config:""},options:{mode:"code",indentation:4,search:!0},dag_editor:null,env_editor:null}},methods:{getFlowDetailData:function(){var t=this;console.log(this.$route.params.flowKey),Object(r.p)(this.query).then(function(e){if(t.flowData=e.data.configs[0],t.flowData){t.form.flow_key=t.flowData.key,t.form.flow_name=t.flowData.name,t.form.flow_desc=t.flowData.desc;var o=document.getElementById("dags_editor");t.dag_editor=new t.$jsoneditor(o,t.options),t.dag_editor.set(t.flowData.config);var a=document.getElementById("env_editor");t.env_editor=new t.$jsoneditor(a,t.options),t.env_editor.set(t.flowData.env)}})},onSubmit:function(){var t=this;this.form.config=n()(this.dag_editor.get()),this.form.env=n()(this.env_editor.get()),Object(r.t)(this.form).then(function(e){"A0001"==e.code?t.$message.success("更新成功！"):t.$message.error(e.msg)})}},created:function(){this.getFlowDetailData()}}),i={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"form-box"},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"任务key"}},[o("el-input",{attrs:{disabled:!0},model:{value:t.form.flow_key,callback:function(e){t.$set(t.form,"flow_key",e)},expression:"form.flow_key"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"任务名称"}},[o("el-input",{model:{value:t.form.flow_name,callback:function(e){t.$set(t.form,"flow_name",e)},expression:"form.flow_name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"描述"}},[o("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:t.form.flow_desc,callback:function(e){t.$set(t.form,"flow_desc",e)},expression:"form.flow_desc"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"依赖配置"}},[o("div",{staticStyle:{height:"500px"},attrs:{id:"dags_editor"}})]),t._v(" "),o("el-form-item",{attrs:{label:"环境变量"}},[o("div",{attrs:{id:"env_editor"}})]),t._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("更新")])],1)],1)],1)},staticRenderFns:[]},l=o("VU/8")(s,i,!1,null,null,null).exports,c=o("Xxa5"),u=o.n(c),f=o("exGp"),d=o.n(f),h={name:"flowdag",data:function(){return{workData:{},flowData:{},svgData:{edges:[],nodes:[]},dquery:{flow_key:this.$route.params.flowKey},wquery:{}}},methods:{getWorkData:function(){var t=this;return d()(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(r.m)(t.wquery).then(function(e){e.data.forEach(function(e){t.workData[e.key]=e,name})});case 2:case"end":return e.stop()}},e,t)}))()},getFlowDagData:function(){var t=this;Object(r.k)(this.dquery).then(function(e){var o,a;(console.log("this is res"),console.log(e),t.flowData=e.data[0],console.log("this is flow data"),console.log(t.flowData),t.flowData)&&function(){t.svgData.nodes=[];var e=[],n=[],r={},s={},i={};t.pointSet;t.flowData.config.works.forEach(function(t){s[t]=1});var l=t.flowData.config.works.length;do{console.log("do loop ..."),l-=1;var c=function(){var e=1;t.flowData.config.dags[a].dependences.forEach(function(t){e<s[t]&&(e=s[t])}),e+1>s[a]&&(s[a]=e+1)};for(a in t.flowData.config.dags)c()}while(l>0);var u={};for(o in console.log("this is svgNodeYLevel"),console.log(s),s)u[s[o]]=1;for(o in s)i[o]=u[s[o]],u[s[o]]+=1;console.log("this is svgNodeXLevel"),console.log(i);var f=t.workData;for(a in t.flowData.config.works.forEach(function(t,o){r[t]=o,e.push({id:o,name:f[t].name,pos_x:250*i[t]+Math.floor(40*Math.random()),pos_y:100*s[t]+Math.floor(20*Math.random()),type:"XGBoostOp",in_ports:[0],out_ports:[0]})}),t.flowData.config.dags)t.flowData.config.dags[a].dependences.forEach(function(t){n.push({dst_input_idx:0,dst_node_id:r[a],id:0,src_node_id:r[t],src_output_idx:0,type:"active"})});console.log(e),t.svgData.nodes=e,t.svgData.edges=n}();console.log("this is svg data"),console.log(t.svgData)})}},created:function(){this.getWorkData().then(this.getFlowDagData())}},p={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"svg"},[e("DAGBoard",{attrs:{DataAll:this.svgData}})],1)},staticRenderFns:[]};var v=o("VU/8")(h,p,!1,function(t){o("qXZA")},null,null).exports;Array.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)};var m=[[0,"待调度"],[1,"调度中"],[2,"完成"],[3,"超时"],[4,"异常"],[5,"失败"],[6,"调度延期"]],g={name:"flowinstance",data:function(){return{checkAll:!0,checkedstates:[],states:m,isIndeterminate:!0,pageTotal:0,tableData:[],subTableData:[],query:{cid:"",vflow:this.$route.params.flowKey,vstates:[],page_index:1,page_size:15},workInstancesQuery:{cid:"",vflow:this.$route.params.flowKey},recoverFlowBody:{flow_ids:[]},deleteFlowBody:{flow_ids:[]},recoverWorkBody:{work_ids:[]},expands:[]}},methods:{handleCheckAllChange:function(t){this.checkedstates=t?m:[],this.isIndeterminate=!1},handleCheckedStatesChange:function(t){console.log(this.states),console.log(this.checkedstates);var e=t.length;this.checkAll=e===this.states.length,this.isIndeterminate=e>0&&e<this.states.length},workTableRowClassName:function(t){var e=t.row;t.rowIndex;return"超时"===e.state?"warning-row":"异常"===e.state?"failed-row":"失败"===e.state?"warning-row":"初始化"===e.state?"success-row":"已下发"===e.state?"success-row":"执行中"===e.state?"success-row":"成功"===e.state?"success-row":"延期调度"===e.state?"success-row":""},tableRowClassName:function(t){var e=t.row;t.rowIndex;return"超时"===e.state?"warning-row":"异常"===e.state?"failed-row":"失败"===e.state?"warning-row":"待调度"===e.state?"success-row":"调度中"===e.state?"success-row":"完成"===e.state?"success-row":"调度延期"===e.state?"success-row":""},expandContext:function(t){console.log("expand row"),this.subTableData=[],this.workInstancesQuery.cid=t.cid,this.getWorkInstanceData(),this.expands.indexOf(t.flow_id)<0?(this.expands=[],this.expands.push(t.flow_id),console.log("if:",this.expands)):(this.expands.remove(t.flow_id),console.log("else:",this.expands))},getFlowInstanceData:function(){var t=this;console.log(this.$route.params.flowKey),Object(r.j)(this.query).then(function(e){t.tableData=e.data.flows,t.pageTotal=e.data.count})},getWorkInstanceData:function(){var t=this;Object(r.l)(this.workInstancesQuery).then(function(e){t.subTableData=e.data.works})},recoverWork:function(t){var e=this;console.log("recover work"),this.recoverWorkBody.work_ids=[t.work_id],Object(r.s)(this.recoverWorkBody).then(function(t){"A0001"==t.code&&t.data.success>0&&e.$message.success("任务重置成功"),e.getWorkInstanceData()})},deleteFlow:function(t){var e=this;this.deleteFlowBody.flow_ids=[t.flow_id],Object(r.h)(this.deleteFlowBody).then(function(t){"A0001"==t.code&&t.data.success>0&&e.$message.success("任务流删除成功"),e.getFlowInstanceData()})},recoverFlow:function(t){var e=this;this.recoverFlowBody.flow_ids=[t.flow_id],Object(r.r)(this.recoverFlowBody).then(function(t){"A0001"==t.code&&t.data.success>0&&e.$message.success("任务流重置成功"),e.getFlowInstanceData()})},handleSearch:function(){this.$set(this.query,"page_index",1);for(var t=[],e=0;e<this.checkedstates.length;e++)t.push(this.checkedstates[e][0]);this.$set(this.query,"vstates",t),this.getFlowInstanceData()},handlePageChange:function(t){this.$set(this.query,"page_index",t),this.getFlowInstanceData()}},created:function(){console.log("im create"),this.getFlowInstanceData()}},w={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"container"},[o("div",{staticClass:"handle-box"},[o("el-form",{attrs:{inline:!0}},[o("el-form-item",[o("el-input",{staticClass:"handle-input",staticStyle:{width:"300px"},attrs:{placeholder:"cid"},model:{value:t.query.cid,callback:function(e){t.$set(t.query,"cid",e)},expression:"query.cid"}})],1),t._v(" "),o("el-form-item",[o("el-checkbox-button",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")])],1),t._v(" "),o("el-form-item",[o("el-checkbox-group",{on:{change:t.handleCheckedStatesChange},model:{value:t.checkedstates,callback:function(e){t.checkedstates=e},expression:"checkedstates"}},t._l(t.states,function(e){return o("el-checkbox-button",{key:e[0],attrs:{label:e}},[t._v(t._s(e[1]))])}),1)],1),t._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("search")])],1)],1)],1),t._v(" "),o("el-table",{ref:"flowInsTable",staticClass:"table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"row-class-name":t.tableRowClassName,border:"","header-cell-class-name":"table-header","row-key":"flow_id","expand-row-keys":t.expands},on:{"expand-change":t.expandContext}},[o("el-table-column",{attrs:{type:"expand"},on:{click:function(e){return t.expandContext(t.row)}},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[o("el-row",{staticClass:"row-bg",attrs:{type:"flex"}},[o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("创建时间:")])])]),t._v(" "),o("el-col",{attrs:{span:4}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",[t._v(t._s(e.row.create_time))])])]),t._v(" "),o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("更新时间:")])])]),t._v(" "),o("el-col",{attrs:{span:4}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",[t._v(t._s(e.row.update_time))])])]),t._v(" "),o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("对象ID:")])])]),t._v(" "),o("el-col",{attrs:{span:4}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",[t._v(t._s(e.row.cid))])])])],1),t._v(" "),o("el-row",{staticClass:"row-bg",attrs:{type:"flex"}},[o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("工作流上下文:")])])]),t._v(" "),o("el-col",{attrs:{span:22}},[o("div",{staticClass:"grid-content bg-purple"},[o("pre",[t._v(t._s(e.row.context))])])])],1),t._v(" "),o("el-divider",{attrs:{"content-position":"left"}},[o("div",{staticStyle:{"font-size":"12px","font-weight":"lighter"}},[t._v("任务列表")])]),t._v(" "),o("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:t.subTableData,"row-class-name":t.workTableRowClassName,"header-cell-class-name":"table-header"}},[o("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[o("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("创建时间:")])])]),t._v(" "),o("el-col",{attrs:{span:4}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",[t._v(t._s(e.row.create_time))])])]),t._v(" "),o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("更新时间:")])])]),t._v(" "),o("el-col",{attrs:{span:4}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",[t._v(t._s(e.row.update_time))])])]),t._v(" "),o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("对象ID:")])])]),t._v(" "),o("el-col",{attrs:{span:4}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",[t._v(t._s(e.row.cid))])])]),t._v(" "),o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("任务名称:")])])]),t._v(" "),o("el-col",{attrs:{span:4}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",[t._v(t._s(e.row.vwork))])])])],1),t._v(" "),o("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("任务输出:")])])]),t._v(" "),o("el-col",{attrs:{span:22}},[o("div",{staticClass:"grid-content bg-purple"},[o("pre",[t._v(t._s(e.row.output))])])])],1),t._v(" "),o("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[o("el-col",{attrs:{span:2}},[o("div",{staticClass:"grid-content bg-purple"},[o("span",{staticStyle:{"font-weight":"lighter"}},[t._v("异常信息:")])])]),t._v(" "),o("el-col",{attrs:{span:22}},[o("div",{staticClass:"grid-content bg-purple"},[o("pre",[t._v(t._s(e.row.error))])])])],1)],1)]}}],null,!0)}),t._v(" "),o("el-table-column",{attrs:{prop:"vwork",label:"vwork"}}),t._v(" "),o("el-table-column",{attrs:{prop:"create_time",label:"create_time"}}),t._v(" "),o("el-table-column",{attrs:{prop:"update_time",label:"update_time"}}),t._v(" "),o("el-table-column",{attrs:{prop:"cid",label:"cid"}}),t._v(" "),o("el-table-column",{attrs:{prop:"state",label:"state"}}),t._v(" "),o("el-table-column",{attrs:{label:"operation"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"recover",placement:"top"}},[o("el-button",{attrs:{icon:"el-icon-refresh",circle:"",disabled:"初始化"==e.row.state||"调度延期"==e.row.state||"成功"==e.row.state},on:{click:function(o){return t.recoverWork(e.row)}}})],1)]}}],null,!0)})],1)],1)]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"flow_id",label:"flow_id"}}),t._v(" "),o("el-table-column",{attrs:{prop:"create_time",label:"create_time"}}),t._v(" "),o("el-table-column",{attrs:{prop:"update_time",label:"update_time"}}),t._v(" "),o("el-table-column",{attrs:{prop:"cid",label:"cid"}}),t._v(" "),o("el-table-column",{attrs:{prop:"state",label:"state"}}),t._v(" "),o("el-table-column",{attrs:{label:"operation"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"recover",placement:"top"}},[o("el-button",{attrs:{icon:"el-icon-refresh",circle:"",disabled:!("失败"==e.row.state||"异常"==e.row.state||"超时"==e.row.state)},on:{click:function(o){return t.recoverFlow(e.row)}}})],1),t._v(" "),o("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"delete",placement:"top"}},[o("el-button",{attrs:{icon:"el-icon-delete",circle:""},on:{click:function(o){return t.deleteFlow(e.row)}}})],1)]}}])})],1),t._v(" "),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":t.query.page_index,"page-size":t.query.page_size,total:t.pageTotal},on:{"current-change":t.handlePageChange}})],1)],1)])},staticRenderFns:[]};var _={name:"flowInsAdd",data:function(){return{body:{vflow:this.$route.params.flowKey,cids:[]},filePostBody:{vflow:this.$route.params.flowKey},form:{flow_key:this.$route.params.flowKey,cids_str:""},fileList:[]}},methods:{handlePreview:function(t){console.log(t)},handlePost:function(t){var e=this;console.log("handle post");var o=document.querySelector("form"),a=new FormData(o);a.append("vflow",this.$route.params.flowKey),a.delete("file"),a.append("file",t.file),Object(r.b)(a).then(function(t){console.log("imhear"),"A0001"==t.code?(e.$message.success("上传成功"),e.form.cids_str="",e.body.cids=[]):e.$message.error("上传失败"),e.$refs.upload.clearFiles(),vm.$refs.upload.uploadFiles.length=0})},onSubmit:function(){var t=this;this.body.cids=[],console.log(this.fileList),console.log(this.$refs.upload.uploadFiles.length),""!=this.form.cids_str||0!=this.$refs.upload.uploadFiles.length?""!=this.form.cids_str?(this.body.cids=this.form.cids_str.split("\n"),Object(r.a)(this.body).then(function(e){"A0001"==e.code?(t.$message.success("success:"+e.data.success+"  error:"+e.data.fail),t.form.cids_str="",t.body.cids=[]):t.$message.error("添加失败")})):this.$refs.upload.submit():this.$message.error("请输入ID或添加文件")}},created:function(){}},y={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"form-box"},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",id:"upload",enctype:"multipart/form-data",method:"post"}},[o("el-row",[o("el-input",{attrs:{disabled:!0},model:{value:t.form.flow_key,callback:function(e){t.$set(t.form,"flow_key",e)},expression:"form.flow_key"}})],1),t._v(" "),o("el-row",{attrs:{gutter:20}},[o("el-col",{attrs:{span:12}},[o("el-input",{attrs:{cols:2,type:"textarea",placeholder:"请输出CID",rows:"20"},model:{value:t.form.cids_str,callback:function(e){t.$set(t.form,"cids_str",e)},expression:"form.cids_str"}})],1),t._v(" "),o("el-col",{attrs:{span:12}},[o("el-upload",{ref:"upload",attrs:{drag:"",action:"","http-request":t.handlePost,"file-list":t.fileList,"auto-upload":!1,"on-preview":t.handlePreview}},[o("i",{staticClass:"el-icon-upload"}),t._v(" "),o("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),o("em",[t._v("点击上传")])])])],1)],1),t._v(" "),o("el-row",[o("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("创建")])],1)],1)],1)},staticRenderFns:[]};var b={name:"Flow",data:function(){return{iswitch:!0,active:0,query:{vflow:this.$route.params.flowKey},upuery:{vflow:this.$route.params.flowKey,switch:1},currentType:"detail",currentView:"flowdetail",tabs:[{type:"details",view:"flowdetail"},{type:"dag",view:"flowdag"},{type:"instance",view:"flowinstance"},{type:"create",view:"flowInsAdd"}]}},methods:{getFlowSwitch:function(){var t=this;Object(r.p)(this.query).then(function(e){console.log("get switch data",e.data.configs[0],e.data.configs[0].switch),1==e.data.configs[0].switch?t.iswitch=!0:t.iswitch=!1})},updateFlowSwitch:function(){var t=this;console.log(this.iswitch),1==this.iswitch?this.upuery.switch=1:this.upuery.switch=0,Object(r.u)(this.upuery).then(function(e){"A0001"==e.code?t.$message.success("更新成功!"):t.$message.error("更新失败!")})},toggle:function(t,e,o){console.log("toggle",t,e,o),this.active=t,this.currentView=e,this.currentType=o}},components:{flowdag:v,flowdetail:l,flowinstance:o("VU/8")(g,w,!1,function(t){o("c5jA")},null,null).exports,flowInsAdd:o("VU/8")(_,y,!1,function(t){o("WXBa")},null,null).exports},created:function(){this.getFlowSwitch()}},k={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"container"},[o("el-row",[o("el-col",{attrs:{span:20}},[o("ul",{staticClass:"innertab"},t._l(t.tabs,function(e,a){return o("li",{staticClass:"innertab",class:{active:t.active==a},on:{click:function(o){return t.toggle(a,e.view,e.type)}}},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.type)+"\n\t\t\t\t\t\t")])}),0)]),t._v(" "),o("el-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[o("h5",[t._v("scheduling switch")])]),t._v(" "),o("el-col",{staticStyle:{"text-align":"right"},attrs:{span:1}},[o("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:t.updateFlowSwitch},model:{value:t.iswitch,callback:function(e){t.iswitch=e},expression:"iswitch"}})],1)],1),t._v(" "),o("hr"),t._v(" "),o(t.currentView,{tag:"component",staticStyle:{"padding-top":"20px"}})],1)])},staticRenderFns:[]};var x=o("VU/8")(b,k,!1,function(t){o("kc8X")},null,null);e.default=x.exports},N2wG:function(t,e){},SldL:function(t,e){!function(e){"use strict";var o,a=Object.prototype,n=a.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag",c="object"==typeof t,u=e.regeneratorRuntime;if(u)c&&(t.exports=u);else{(u=e.regeneratorRuntime=c?t.exports:{}).wrap=y;var f="suspendedStart",d="suspendedYield",h="executing",p="completed",v={},m={};m[s]=function(){return this};var g=Object.getPrototypeOf,w=g&&g(g(L([])));w&&w!==a&&n.call(w,s)&&(m=w);var _=C.prototype=k.prototype=Object.create(m);x.prototype=_.constructor=C,C.constructor=x,C[l]=x.displayName="GeneratorFunction",u.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===x||"GeneratorFunction"===(e.displayName||e.name))},u.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,C):(t.__proto__=C,l in t||(t[l]="GeneratorFunction")),t.prototype=Object.create(_),t},u.awrap=function(t){return{__await:t}},D($.prototype),$.prototype[i]=function(){return this},u.AsyncIterator=$,u.async=function(t,e,o,a){var n=new $(y(t,e,o,a));return u.isGeneratorFunction(e)?n:n.next().then(function(t){return t.done?t.value:n.next()})},D(_),_[l]="Generator",_[s]=function(){return this},_.toString=function(){return"[object Generator]"},u.keys=function(t){var e=[];for(var o in t)e.push(o);return e.reverse(),function o(){for(;e.length;){var a=e.pop();if(a in t)return o.value=a,o.done=!1,o}return o.done=!0,o}},u.values=L,E.prototype={constructor:E,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(j),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=o)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function a(a,n){return i.type="throw",i.arg=t,e.next=a,n&&(e.method="next",e.arg=o),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],i=s.completion;if("root"===s.tryLoc)return a("end");if(s.tryLoc<=this.prev){var l=n.call(s,"catchLoc"),c=n.call(s,"finallyLoc");if(l&&c){if(this.prev<s.catchLoc)return a(s.catchLoc,!0);if(this.prev<s.finallyLoc)return a(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return a(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return a(s.finallyLoc)}}}},abrupt:function(t,e){for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var s=r?r.completion:{};return s.type=t,s.arg=e,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.finallyLoc===t)return this.complete(o.completion,o.afterLoc),j(o),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var o=this.tryEntries[e];if(o.tryLoc===t){var a=o.completion;if("throw"===a.type){var n=a.arg;j(o)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,a){return this.delegate={iterator:L(t),resultName:e,nextLoc:a},"next"===this.method&&(this.arg=o),v}}}function y(t,e,o,a){var n=e&&e.prototype instanceof k?e:k,r=Object.create(n.prototype),s=new E(a||[]);return r._invoke=function(t,e,o){var a=f;return function(n,r){if(a===h)throw new Error("Generator is already running");if(a===p){if("throw"===n)throw r;return O()}for(o.method=n,o.arg=r;;){var s=o.delegate;if(s){var i=S(s,o);if(i){if(i===v)continue;return i}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(a===f)throw a=p,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);a=h;var l=b(t,e,o);if("normal"===l.type){if(a=o.done?p:d,l.arg===v)continue;return{value:l.arg,done:o.done}}"throw"===l.type&&(a=p,o.method="throw",o.arg=l.arg)}}}(t,o,s),r}function b(t,e,o){try{return{type:"normal",arg:t.call(e,o)}}catch(t){return{type:"throw",arg:t}}}function k(){}function x(){}function C(){}function D(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function $(t){var e;this._invoke=function(o,a){function r(){return new Promise(function(e,r){!function e(o,a,r,s){var i=b(t[o],t,a);if("throw"!==i.type){var l=i.arg,c=l.value;return c&&"object"==typeof c&&n.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,r,s)},function(t){e("throw",t,r,s)}):Promise.resolve(c).then(function(t){l.value=t,r(l)},s)}s(i.arg)}(o,a,e,r)})}return e=e?e.then(r,r):r()}}function S(t,e){var a=t.iterator[e.method];if(a===o){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=o,S(t,e),"throw"===e.method))return v;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var n=b(a,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,v;var r=n.arg;return r?r.done?(e[t.resultName]=r.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=o),e.delegate=null,v):r:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,v)}function F(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function E(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(F,this),this.reset(!0)}function L(t){if(t){var e=t[s];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,r=function e(){for(;++a<t.length;)if(n.call(t,a))return e.value=t[a],e.done=!1,e;return e.value=o,e.done=!0,e};return r.next=r}}return{next:O}}function O(){return{value:o,done:!0}}}(function(){return this}()||Function("return this")())},"VJX/":function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=o("mvHQ"),n=o.n(a),r={name:"FlowDetailComponent",data:function(){return{form:{flow_name:"",flow_key:"",flow_desc:"",env:"{}",config:"{}"},options:{mode:"code",indentation:4,search:!0},dag_editor:null,env_editor:null}},props:["form"],methods:{reinit:function(){console.log("FlowDetailComponent Reinit."),this.form.flow_name="",this.form.flow_key="",this.form.flow_desc="",this.form.env={},this.form.config={},this.initJsonEditor()},refresh:function(){this.form.config=n()(this.dag_editor.get()),this.form.env=n()(this.env_editor.get())},initJsonEditor:function(){var t=document.getElementById("dags_editor");t.innerHTML="",this.dag_editor=new this.$jsoneditor(t,this.options),this.dag_editor.set(this.form.config);var e=document.getElementById("env_editor");e.innerHTML="",this.env_editor=new this.$jsoneditor(e,this.options),this.env_editor.set(this.form.env)}},created:function(){var t=this;this.$nextTick(function(){t.reinit()})}},s={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"form-box"},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[o("el-form-item",{attrs:{label:"任务key"}},[o("el-input",{model:{value:t.form.flow_key,callback:function(e){t.$set(t.form,"flow_key",e)},expression:"form.flow_key"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"任务名称"}},[o("el-input",{model:{value:t.form.flow_name,callback:function(e){t.$set(t.form,"flow_name",e)},expression:"form.flow_name"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"描述"}},[o("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:t.form.flow_desc,callback:function(e){t.$set(t.form,"flow_desc",e)},expression:"form.flow_desc"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"依赖配置"}},[o("div",{attrs:{id:"dags_editor"}})]),t._v(" "),o("el-form-item",{attrs:{label:"环境变量"}},[o("div",{attrs:{id:"env_editor"}})])],1)],1)},staticRenderFns:[]},i=o("VU/8")(r,s,!1,null,null,null).exports,l=o("gyMJ"),c={name:"iflows",data:function(){return{query:{search:"",page_index:1,page_size:13},tableData:[],multipleSelection:[],delList:[],editVisible:!1,copyVisible:!1,createVisible:!1,pageTotal:0,form:{},idx:-1,id:-1,copyParams:{src_flow_key:"",flow_key:""},createParams:{flow_name:"",flow_key:"",flow_desc:"",env:"",config:""},deleteParams:{flow_key:""}}},created:function(){this.getData()},components:{FlowDetailComponent:i},methods:{getData:function(){var t=this;Object(l.p)(this.query).then(function(e){t.tableData=e.data.configs,t.pageTotal=e.data.count})},jump:function(t){console.log("jump",t),this.$router.push("iflows/"+t)},handleSearch:function(){this.$set(this.query,"page_index",1),this.getData()},handleDelete:function(t,e){var o=this;this.deleteParams.flow_key=e.key,this.$confirm("确定要删除吗？","提示",{type:"warning"}).then(function(){Object(l.g)(o.deleteParams).then(function(e){"A0001"==e.code?(o.$message.success("删除成功"),o.tableData.splice(t,1)):o.$message.error(e.msg)})}).catch(function(){})},handleSelectionChange:function(t){this.multipleSelection=t},delAllSelection:function(){var t=this.multipleSelection.length,e="";this.delList=this.delList.concat(this.multipleSelection);for(var o=0;o<t;o++)e+=this.multipleSelection[o].name+" ";this.$message.error("删除了"+e),this.multipleSelection=[]},handleCreate:function(){this.createVisible=!0},handleEdit:function(t,e){this.idx=t,this.form=e,this.editVisible=!0},handleCopy:function(t,e){this.idx=t,this.form=e,this.copyParams.src_flow_key=this.form.key,this.copyParams.flow_key=this.form.key,this.copyVisible=!0},saveCopy:function(){var t=this;this.copyVisible=!1,Object(l.c)(this.copyParams).then(function(e){t.$message.success("复制成功"),t.getData()})},saveCreate:function(){var t=this;this.$refs.flowdetail.refresh(),this.createVisible=!1,Object(l.e)(this.createParams).then(function(e){"A0001"==e.code?t.$message.success("创建成功"):t.$message.error("创建失败"),t.getData()})},saveEdit:function(){this.editVisible=!1,this.$message.success("修改第 "+(this.idx+1)+" 行成功"),this.$set(this.tableData,this.idx,this.form)},handlePageChange:function(t){this.$set(this.query,"page_index",t),this.getData()}}},u={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",[o("div",{staticClass:"container"},[o("div",{staticClass:"handle-box"},[o("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"flow key"},model:{value:t.query.search,callback:function(e){t.$set(t.query,"search",e)},expression:"query.search"}}),t._v(" "),o("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("search")]),t._v(" "),o("el-button",{staticClass:"handle-add mr10",staticStyle:{float:"right"},attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:t.handleCreate}},[t._v("create")])],1),t._v(" "),o("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:t.tableData,border:"","header-cell-class-name":"table-header"},on:{"selection-change":t.handleSelectionChange}},[o("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t._v(" "),o("el-table-column",{attrs:{prop:"Key",label:"key"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("a",{attrs:{href:"javascript:void(0)"},on:{click:function(o){return t.jump(e.row.key)}}},[t._v(t._s(e.row.key))])]}}])}),t._v(" "),o("el-table-column",{attrs:{prop:"name",label:"name"}}),t._v(" "),o("el-table-column",{attrs:{prop:"desc",label:"desc"}}),t._v(" "),o("el-table-column",{attrs:{label:"operation",width:"180",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[o("el-button",{attrs:{type:"text",icon:"el-icon-copy-document"},on:{click:function(o){return t.handleCopy(e.$index,e.row)}}},[t._v("copy")]),t._v(" "),o("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(o){return t.handleDelete(e.$index,e.row)}}},[t._v("delete")])]}}])})],1),t._v(" "),o("div",{staticClass:"pagination"},[o("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":t.query.page_index,"page-size":t.query.page_size,total:t.pageTotal},on:{"current-change":t.handlePageChange}})],1)],1),t._v(" "),o("el-dialog",{attrs:{title:"创建",visible:t.createVisible},on:{"update:visible":function(e){t.createVisible=e}}},[o("FlowDetailComponent",{ref:"flowdetail",attrs:{form:t.createParams}}),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.createVisible=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.saveCreate}},[t._v("确 定")])],1)],1),t._v(" "),o("el-dialog",{attrs:{title:"复制",visible:t.copyVisible,width:"30%"},on:{"update:visible":function(e){t.copyVisible=e}}},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"70px"}},[o("el-form-item",{attrs:{label:"flowKey"}},[o("el-input",{model:{value:t.copyParams.flow_key,callback:function(e){t.$set(t.copyParams,"flow_key",e)},expression:"copyParams.flow_key"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.copyVisible=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.saveCopy}},[t._v("确 定")])],1)],1),t._v(" "),o("el-dialog",{attrs:{title:"编辑",visible:t.editVisible,width:"30%"},on:{"update:visible":function(e){t.editVisible=e}}},[o("el-form",{ref:"form",attrs:{model:t.form,"label-width":"70px"}},[o("el-form-item",{attrs:{label:"flow key"}},[o("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.editVisible=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:t.saveEdit}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var f=o("VU/8")(c,u,!1,function(t){o("N2wG")},"data-v-79a37734",null);e.default=f.exports},WXBa:function(t,e){},Xxa5:function(t,e,o){t.exports=o("jyFz")},c5jA:function(t,e){},exGp:function(t,e,o){"use strict";e.__esModule=!0;var a,n=o("//Fk"),r=(a=n)&&a.__esModule?a:{default:a};e.default=function(t){return function(){var e=t.apply(this,arguments);return new r.default(function(t,o){return function a(n,s){try{var i=e[n](s),l=i.value}catch(t){return void o(t)}if(!i.done)return r.default.resolve(l).then(function(t){a("next",t)},function(t){a("throw",t)});t(l)}("next")})}}},jyFz:function(t,e,o){var a=function(){return this}()||Function("return this")(),n=a.regeneratorRuntime&&Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime")>=0,r=n&&a.regeneratorRuntime;if(a.regeneratorRuntime=void 0,t.exports=o("SldL"),n)a.regeneratorRuntime=r;else try{delete a.regeneratorRuntime}catch(t){a.regeneratorRuntime=void 0}},kc8X:function(t,e){},qXZA:function(t,e){}});
//# sourceMappingURL=1.759592ae2df0341c32d1.js.map