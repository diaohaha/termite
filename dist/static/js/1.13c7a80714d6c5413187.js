webpackJsonp([1],{KGoD:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("mvHQ"),s=a.n(o),l=a("gyMJ"),i=(a("pFYg"),{name:"flowdetail",data:function(){return{flowData:{},query:{vflow:this.$route.params.flowKey},form:{flow_name:"",flow_key:"",flow_desc:"",env:"",config:""},options:{mode:"code",indentation:4,search:!0},dag_editor:null,env_editor:null}},methods:{getFlowDetailData:function(){var t=this;console.log(this.$route.params.flowKey),Object(l.p)(this.query).then(function(e){if(t.flowData=e.data.configs[0],t.flowData){t.form.flow_key=t.flowData.key,t.form.flow_name=t.flowData.name,t.form.flow_desc=t.flowData.desc;var a=document.getElementById("dags_editor");t.dag_editor=new t.$jsoneditor(a,t.options),t.dag_editor.set(t.flowData.config);var o=document.getElementById("env_editor");t.env_editor=new t.$jsoneditor(o,t.options),t.env_editor.set(t.flowData.env)}})},onSubmit:function(){var t=this;this.form.config=s()(this.dag_editor.get()),this.form.env=s()(this.env_editor.get()),Object(l.t)(this.form).then(function(e){"A0001"==e.code?t.$message.success("更新成功！"):t.$message.error(e.msg)})}},created:function(){this.getFlowDetailData()}}),n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form-box"},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"任务key"}},[a("el-input",{attrs:{disabled:!0},model:{value:t.form.flow_key,callback:function(e){t.$set(t.form,"flow_key",e)},expression:"form.flow_key"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任务名称"}},[a("el-input",{model:{value:t.form.flow_name,callback:function(e){t.$set(t.form,"flow_name",e)},expression:"form.flow_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:t.form.flow_desc,callback:function(e){t.$set(t.form,"flow_desc",e)},expression:"form.flow_desc"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"依赖配置"}},[a("div",{staticStyle:{height:"500px"},attrs:{id:"dags_editor"}})]),t._v(" "),a("el-form-item",{attrs:{label:"环境变量"}},[a("div",{attrs:{id:"env_editor"}})]),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("更新")])],1)],1)],1)},staticRenderFns:[]},r=a("VU/8")(i,n,!1,null,null,null).exports,c={name:"flowdag",data:function(){return{workData:{},flowData:{},svgData:{edges:[],nodes:[]},dquery:{flow_key:this.$route.params.flowKey},wquery:{}}},methods:{getWorkData:function(){var t=this;Object(l.m)(this.wquery).then(function(e){e.data.forEach(function(e){t.workData[e.key]=e})})},getFlowDagData:function(){var t=this;Object(l.k)(this.dquery).then(function(e){var a,o;(console.log("this is res"),console.log(e),t.flowData=e.data[0],console.log("this is flow data"),console.log(t.flowData),t.flowData)&&function(){t.svgData.nodes=[];var e=[],s=[],l={},i={},n={};t.pointSet;t.flowData.config.works.forEach(function(t){i[t]=1});var r=t.flowData.config.works.length;do{console.log("do loop ..."),r-=1;var c=function(){var e=1;t.flowData.config.dags[o].dependences.forEach(function(t){e<i[t]&&(e=i[t])}),e+1>i[o]&&(i[o]=e+1)};for(o in t.flowData.config.dags)c()}while(r>0);var d={};for(a in console.log("this is svgNodeYLevel"),console.log(i),i)d[i[a]]=1;for(a in i)n[a]=d[i[a]],d[i[a]]+=1;console.log("this is svgNodeXLevel"),console.log(n);var f=t.workData;for(o in console.log("workData",t.workData),console.log("workDataTmp",f),console.log("flowData.config",t.flowData.config.works),t.flowData.config.works.forEach(function(t,a){console.log("item:",t,"workDataTmp[item]",f[t]),l[t]=a,e.push({id:a,name:f[t].name,pos_x:250*n[t]+Math.floor(40*Math.random()),pos_y:100*i[t]+Math.floor(20*Math.random()),type:"XGBoostOp",in_ports:[0],out_ports:[0]})}),t.flowData.config.dags)t.flowData.config.dags[o].dependences.forEach(function(t){s.push({dst_input_idx:0,dst_node_id:l[o],id:0,src_node_id:l[t],src_output_idx:0,type:"active"})});console.log("svgDataNodes",e),t.svgData.nodes=e,t.svgData.edges=s}();console.log("this is svg data"),console.log(t.svgData)})}},created:function(){this.getWorkData(),setTimeout(this.getFlowDagData,100)}},d={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"svg"},[e("DAGBoard",{attrs:{DataAll:this.svgData}})],1)},staticRenderFns:[]};var f=a("VU/8")(c,d,!1,function(t){a("bLri")},null,null).exports;Array.prototype.remove=function(t){var e=this.indexOf(t);e>-1&&this.splice(e,1)};var u=[[0,"待调度"],[1,"调度中"],[2,"完成"],[3,"超时"],[4,"异常"],[5,"失败"],[6,"调度延期"]],p={name:"flowinstance",data:function(){return{checkAll:!0,checkedstates:[],states:u,isIndeterminate:!0,pageTotal:0,tableData:[],subTableData:[],query:{cid:"",vflow:this.$route.params.flowKey,vstates:[],page_index:1,page_size:15},workInstancesQuery:{cid:"",vflow:this.$route.params.flowKey},recoverFlowBody:{flow_ids:[]},deleteFlowBody:{flow_ids:[]},recoverWorkBody:{work_ids:[]},expands:[]}},methods:{handleCheckAllChange:function(t){this.checkedstates=t?u:[],this.isIndeterminate=!1},handleCheckedStatesChange:function(t){console.log(this.states),console.log(this.checkedstates);var e=t.length;this.checkAll=e===this.states.length,this.isIndeterminate=e>0&&e<this.states.length},workTableRowClassName:function(t){var e=t.row;t.rowIndex;return"超时"===e.state?"warning-row":"异常"===e.state?"failed-row":"失败"===e.state?"warning-row":"初始化"===e.state?"success-row":"已下发"===e.state?"success-row":"执行中"===e.state?"success-row":"成功"===e.state?"success-row":"延期调度"===e.state?"success-row":""},tableRowClassName:function(t){var e=t.row;t.rowIndex;return"超时"===e.state?"warning-row":"异常"===e.state?"failed-row":"失败"===e.state?"warning-row":"待调度"===e.state?"success-row":"调度中"===e.state?"success-row":"完成"===e.state?"success-row":"调度延期"===e.state?"success-row":""},expandContext:function(t){console.log("expand row"),this.subTableData=[],this.workInstancesQuery.cid=t.cid,this.getWorkInstanceData(),this.expands.indexOf(t.flow_id)<0?(this.expands=[],this.expands.push(t.flow_id),console.log("if:",this.expands)):(this.expands.remove(t.flow_id),console.log("else:",this.expands))},getFlowInstanceData:function(){var t=this;console.log(this.$route.params.flowKey),Object(l.j)(this.query).then(function(e){t.tableData=e.data.flows,t.pageTotal=e.data.count})},getWorkInstanceData:function(){var t=this;Object(l.l)(this.workInstancesQuery).then(function(e){t.subTableData=e.data.works})},recoverWork:function(t){var e=this;console.log("recover work"),this.recoverWorkBody.work_ids=[t.work_id],Object(l.s)(this.recoverWorkBody).then(function(t){"A0001"==t.code&&t.data.success>0&&e.$message.success("任务重置成功"),e.getWorkInstanceData()})},deleteFlow:function(t){var e=this;this.deleteFlowBody.flow_ids=[t.flow_id],Object(l.h)(this.deleteFlowBody).then(function(t){"A0001"==t.code&&t.data.success>0&&e.$message.success("任务流删除成功"),e.getFlowInstanceData()})},recoverFlow:function(t){var e=this;this.recoverFlowBody.flow_ids=[t.flow_id],Object(l.r)(this.recoverFlowBody).then(function(t){"A0001"==t.code&&t.data.success>0&&e.$message.success("任务流重置成功"),e.getFlowInstanceData()})},handleSearch:function(){this.$set(this.query,"page_index",1);for(var t=[],e=0;e<this.checkedstates.length;e++)t.push(this.checkedstates[e][0]);this.$set(this.query,"vstates",t),this.getFlowInstanceData()},handlePageChange:function(t){this.$set(this.query,"page_index",t),this.getFlowInstanceData()}},created:function(){console.log("im create"),this.getFlowInstanceData()}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",[a("el-input",{staticClass:"handle-input",staticStyle:{width:"300px"},attrs:{placeholder:"cid"},model:{value:t.query.cid,callback:function(e){t.$set(t.query,"cid",e)},expression:"query.cid"}})],1),t._v(" "),a("el-form-item",[a("el-checkbox-button",{attrs:{indeterminate:t.isIndeterminate},on:{change:t.handleCheckAllChange},model:{value:t.checkAll,callback:function(e){t.checkAll=e},expression:"checkAll"}},[t._v("全选")])],1),t._v(" "),a("el-form-item",[a("el-checkbox-group",{on:{change:t.handleCheckedStatesChange},model:{value:t.checkedstates,callback:function(e){t.checkedstates=e},expression:"checkedstates"}},t._l(t.states,function(e){return a("el-checkbox-button",{key:e[0],attrs:{label:e}},[t._v(t._s(e[1]))])}),1)],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("search")])],1)],1)],1),t._v(" "),a("el-table",{ref:"flowInsTable",staticClass:"table",staticStyle:{width:"100%"},attrs:{data:t.tableData,"row-class-name":t.tableRowClassName,border:"","header-cell-class-name":"table-header","row-key":"flow_id","expand-row-keys":t.expands},on:{"expand-change":t.expandContext}},[a("el-table-column",{attrs:{type:"expand"},on:{click:function(e){return t.expandContext(t.row)}},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-row",{staticClass:"row-bg",attrs:{type:"flex"}},[a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("创建时间:")])])]),t._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[t._v(t._s(e.row.create_time))])])]),t._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("更新时间:")])])]),t._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[t._v(t._s(e.row.update_time))])])]),t._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("对象ID:")])])]),t._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[t._v(t._s(e.row.cid))])])])],1),t._v(" "),a("el-row",{staticClass:"row-bg",attrs:{type:"flex"}},[a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("工作流上下文:")])])]),t._v(" "),a("el-col",{attrs:{span:22}},[a("div",{staticClass:"grid-content bg-purple"},[a("pre",[t._v(t._s(e.row.context))])])])],1),t._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[a("div",{staticStyle:{"font-size":"12px","font-weight":"lighter"}},[t._v("任务列表")])]),t._v(" "),a("el-table",{staticClass:"table",staticStyle:{width:"100%"},attrs:{data:t.subTableData,"row-class-name":t.workTableRowClassName,"header-cell-class-name":"table-header"}},[a("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",attrs:{"label-position":"left",inline:""}},[a("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("创建时间:")])])]),t._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[t._v(t._s(e.row.create_time))])])]),t._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("更新时间:")])])]),t._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[t._v(t._s(e.row.update_time))])])]),t._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("对象ID:")])])]),t._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[t._v(t._s(e.row.cid))])])]),t._v(" "),a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("任务名称:")])])]),t._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[t._v(t._s(e.row.vwork))])])])],1),t._v(" "),a("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("任务输出:")])])]),t._v(" "),a("el-col",{attrs:{span:22}},[a("div",{staticClass:"grid-content bg-purple"},[a("pre",[t._v(t._s(e.row.output))])])])],1),t._v(" "),a("el-row",{staticClass:"row-bg",attrs:{type:"flex",justify:"space-around"}},[a("el-col",{attrs:{span:2}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",{staticStyle:{"font-weight":"lighter"}},[t._v("异常信息:")])])]),t._v(" "),a("el-col",{attrs:{span:22}},[a("div",{staticClass:"grid-content bg-purple"},[a("pre",[t._v(t._s(e.row.error))])])])],1)],1)]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{prop:"vwork",label:"vwork"}}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"create_time"}}),t._v(" "),a("el-table-column",{attrs:{prop:"update_time",label:"update_time"}}),t._v(" "),a("el-table-column",{attrs:{prop:"cid",label:"cid"}}),t._v(" "),a("el-table-column",{attrs:{prop:"state",label:"state"}}),t._v(" "),a("el-table-column",{attrs:{label:"operation"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"recover",placement:"top"}},[a("el-button",{attrs:{icon:"el-icon-refresh",circle:"",disabled:"初始化"==e.row.state||"调度延期"==e.row.state||"成功"==e.row.state},on:{click:function(a){return t.recoverWork(e.row)}}})],1)]}}],null,!0)})],1)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"flow_id",label:"flow_id"}}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"create_time"}}),t._v(" "),a("el-table-column",{attrs:{prop:"update_time",label:"update_time"}}),t._v(" "),a("el-table-column",{attrs:{prop:"cid",label:"cid"}}),t._v(" "),a("el-table-column",{attrs:{prop:"state",label:"state"}}),t._v(" "),a("el-table-column",{attrs:{label:"operation"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"recover",placement:"top"}},[a("el-button",{attrs:{icon:"el-icon-refresh",circle:"",disabled:!("失败"==e.row.state||"异常"==e.row.state||"超时"==e.row.state)},on:{click:function(a){return t.recoverFlow(e.row)}}})],1),t._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"delete",placement:"top"}},[a("el-button",{attrs:{icon:"el-icon-delete",circle:""},on:{click:function(a){return t.deleteFlow(e.row)}}})],1)]}}])})],1),t._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":t.query.page_index,"page-size":t.query.page_size,total:t.pageTotal},on:{"current-change":t.handlePageChange}})],1)],1)])},staticRenderFns:[]};var m={name:"flowInsAdd",data:function(){return{body:{vflow:this.$route.params.flowKey,cids:[]},filePostBody:{vflow:this.$route.params.flowKey},form:{flow_key:this.$route.params.flowKey,cids_str:""},fileList:[]}},methods:{handlePreview:function(t){console.log(t)},handlePost:function(t){var e=this;console.log("handle post");var a=document.querySelector("form"),o=new FormData(a);o.append("vflow",this.$route.params.flowKey),o.delete("file"),o.append("file",t.file),Object(l.b)(o).then(function(t){console.log("imhear"),"A0001"==t.code?(e.$message.success("上传成功"),e.form.cids_str="",e.body.cids=[]):e.$message.error("上传失败"),e.$refs.upload.clearFiles(),vm.$refs.upload.uploadFiles.length=0})},onSubmit:function(){var t=this;this.body.cids=[],console.log(this.fileList),console.log(this.$refs.upload.uploadFiles.length),""!=this.form.cids_str||0!=this.$refs.upload.uploadFiles.length?""!=this.form.cids_str?(this.body.cids=this.form.cids_str.split("\n"),Object(l.a)(this.body).then(function(e){"A0001"==e.code?(t.$message.success("success:"+e.data.success+"  error:"+e.data.fail),t.form.cids_str="",t.body.cids=[]):t.$message.error("添加失败")})):this.$refs.upload.submit():this.$message.error("请输入ID或添加文件")}},created:function(){}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form-box"},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px",id:"upload",enctype:"multipart/form-data",method:"post"}},[a("el-row",[a("el-input",{attrs:{disabled:!0},model:{value:t.form.flow_key,callback:function(e){t.$set(t.form,"flow_key",e)},expression:"form.flow_key"}})],1),t._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{cols:2,type:"textarea",placeholder:"请输出CID",rows:"20"},model:{value:t.form.cids_str,callback:function(e){t.$set(t.form,"cids_str",e)},expression:"form.cids_str"}})],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-upload",{ref:"upload",attrs:{drag:"",action:"","http-request":t.handlePost,"file-list":t.fileList,"auto-upload":!1,"on-preview":t.handlePreview}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),a("em",[t._v("点击上传")])])])],1)],1),t._v(" "),a("el-row",[a("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:t.onSubmit}},[t._v("创建")])],1)],1)],1)},staticRenderFns:[]};var w={name:"Flow",data:function(){return{iswitch:!0,active:0,query:{vflow:this.$route.params.flowKey},upuery:{vflow:this.$route.params.flowKey,switch:1},currentType:"detail",currentView:"flowdetail",tabs:[{type:"details",view:"flowdetail"},{type:"dag",view:"flowdag"},{type:"instance",view:"flowinstance"},{type:"create",view:"flowInsAdd"}]}},methods:{getFlowSwitch:function(){var t=this;Object(l.p)(this.query).then(function(e){console.log("get switch data",e.data.configs[0],e.data.configs[0].switch),1==e.data.configs[0].switch?t.iswitch=!0:t.iswitch=!1})},updateFlowSwitch:function(){var t=this;console.log(this.iswitch),1==this.iswitch?this.upuery.switch=1:this.upuery.switch=0,Object(l.u)(this.upuery).then(function(e){"A0001"==e.code?t.$message.success("更新成功!"):t.$message.error("更新失败!")})},toggle:function(t,e,a){console.log("toggle",t,e,a),this.active=t,this.currentView=e,this.currentType=a}},components:{flowdag:f,flowdetail:r,flowinstance:a("VU/8")(p,h,!1,function(t){a("c5jA")},null,null).exports,flowInsAdd:a("VU/8")(m,v,!1,function(t){a("WXBa")},null,null).exports},created:function(){this.getFlowSwitch()}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"container"},[a("el-row",[a("el-col",{attrs:{span:20}},[a("ul",{staticClass:"innertab"},t._l(t.tabs,function(e,o){return a("li",{staticClass:"innertab",class:{active:t.active==o},on:{click:function(a){return t.toggle(o,e.view,e.type)}}},[t._v("\n\t\t\t\t\t\t\t"+t._s(e.type)+"\n\t\t\t\t\t\t")])}),0)]),t._v(" "),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:3}},[a("h5",[t._v("scheduling switch")])]),t._v(" "),a("el-col",{staticStyle:{"text-align":"right"},attrs:{span:1}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:t.updateFlowSwitch},model:{value:t.iswitch,callback:function(e){t.iswitch=e},expression:"iswitch"}})],1)],1),t._v(" "),a("hr"),t._v(" "),a(t.currentView,{tag:"component",staticStyle:{"padding-top":"20px"}})],1)])},staticRenderFns:[]};var _=a("VU/8")(w,g,!1,function(t){a("kc8X")},null,null);e.default=_.exports},N2wG:function(t,e){},"VJX/":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("mvHQ"),s=a.n(o),l={name:"FlowDetailComponent",data:function(){return{form:{flow_name:"",flow_key:"",flow_desc:"",env:"{}",config:"{}"},options:{mode:"code",indentation:4,search:!0},dag_editor:null,env_editor:null}},props:["form"],methods:{reinit:function(){console.log("FlowDetailComponent Reinit."),this.form.flow_name="",this.form.flow_key="",this.form.flow_desc="",this.form.env={},this.form.config={},this.initJsonEditor()},refresh:function(){this.form.config=s()(this.dag_editor.get()),this.form.env=s()(this.env_editor.get())},initJsonEditor:function(){var t=document.getElementById("dags_editor");t.innerHTML="",this.dag_editor=new this.$jsoneditor(t,this.options),this.dag_editor.set(this.form.config);var e=document.getElementById("env_editor");e.innerHTML="",this.env_editor=new this.$jsoneditor(e,this.options),this.env_editor.set(this.form.env)}},created:function(){var t=this;this.$nextTick(function(){t.reinit()})}},i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"form-box"},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"任务key"}},[a("el-input",{model:{value:t.form.flow_key,callback:function(e){t.$set(t.form,"flow_key",e)},expression:"form.flow_key"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"任务名称"}},[a("el-input",{model:{value:t.form.flow_name,callback:function(e){t.$set(t.form,"flow_name",e)},expression:"form.flow_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",rows:"5"},model:{value:t.form.flow_desc,callback:function(e){t.$set(t.form,"flow_desc",e)},expression:"form.flow_desc"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"依赖配置"}},[a("div",{attrs:{id:"dags_editor"}})]),t._v(" "),a("el-form-item",{attrs:{label:"环境变量"}},[a("div",{attrs:{id:"env_editor"}})])],1)],1)},staticRenderFns:[]},n=a("VU/8")(l,i,!1,null,null,null).exports,r=a("gyMJ"),c={name:"iflows",data:function(){return{query:{search:"",page_index:1,page_size:13},tableData:[],multipleSelection:[],delList:[],editVisible:!1,copyVisible:!1,createVisible:!1,pageTotal:0,form:{},idx:-1,id:-1,copyParams:{src_flow_key:"",flow_key:""},createParams:{flow_name:"",flow_key:"",flow_desc:"",env:"",config:""},deleteParams:{flow_key:""}}},created:function(){this.getData()},components:{FlowDetailComponent:n},methods:{getData:function(){var t=this;Object(r.p)(this.query).then(function(e){t.tableData=e.data.configs,t.pageTotal=e.data.count})},jump:function(t){console.log("jump",t),this.$router.push("iflows/"+t)},handleSearch:function(){this.$set(this.query,"page_index",1),this.getData()},handleDelete:function(t,e){var a=this;this.deleteParams.flow_key=e.key,this.$confirm("确定要删除吗？","提示",{type:"warning"}).then(function(){Object(r.g)(a.deleteParams).then(function(e){"A0001"==e.code?(a.$message.success("删除成功"),a.tableData.splice(t,1)):a.$message.error(e.msg)})}).catch(function(){})},handleSelectionChange:function(t){this.multipleSelection=t},delAllSelection:function(){var t=this.multipleSelection.length,e="";this.delList=this.delList.concat(this.multipleSelection);for(var a=0;a<t;a++)e+=this.multipleSelection[a].name+" ";this.$message.error("删除了"+e),this.multipleSelection=[]},handleCreate:function(){this.createVisible=!0},handleEdit:function(t,e){this.idx=t,this.form=e,this.editVisible=!0},handleCopy:function(t,e){this.idx=t,this.form=e,this.copyParams.src_flow_key=this.form.key,this.copyParams.flow_key=this.form.key,this.copyVisible=!0},saveCopy:function(){var t=this;this.copyVisible=!1,Object(r.c)(this.copyParams).then(function(e){t.$message.success("复制成功"),t.getData()})},saveCreate:function(){var t=this;this.$refs.flowdetail.refresh(),this.createVisible=!1,Object(r.e)(this.createParams).then(function(e){"A0001"==e.code?t.$message.success("创建成功"):t.$message.error("创建失败"),t.getData()})},saveEdit:function(){this.editVisible=!1,this.$message.success("修改第 "+(this.idx+1)+" 行成功"),this.$set(this.tableData,this.idx,this.form)},handlePageChange:function(t){this.$set(this.query,"page_index",t),this.getData()}}},d={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"container"},[a("div",{staticClass:"handle-box"},[a("el-input",{staticClass:"handle-input mr10",attrs:{placeholder:"flow key"},model:{value:t.query.search,callback:function(e){t.$set(t.query,"search",e)},expression:"query.search"}}),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleSearch}},[t._v("search")]),t._v(" "),a("el-button",{staticClass:"handle-add mr10",staticStyle:{float:"right"},attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:t.handleCreate}},[t._v("create")])],1),t._v(" "),a("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:t.tableData,border:"","header-cell-class-name":"table-header"},on:{"selection-change":t.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Key",label:"key"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",{attrs:{href:"javascript:void(0)"},on:{click:function(a){return t.jump(e.row.key)}}},[t._v(t._s(e.row.key))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"name"}}),t._v(" "),a("el-table-column",{attrs:{prop:"desc",label:"desc"}}),t._v(" "),a("el-table-column",{attrs:{label:"operation",width:"180",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",icon:"el-icon-copy-document"},on:{click:function(a){return t.handleCopy(e.$index,e.row)}}},[t._v("copy")]),t._v(" "),a("el-button",{staticClass:"red",attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(a){return t.handleDelete(e.$index,e.row)}}},[t._v("delete")])]}}])})],1),t._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":t.query.page_index,"page-size":t.query.page_size,total:t.pageTotal},on:{"current-change":t.handlePageChange}})],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"创建",visible:t.createVisible},on:{"update:visible":function(e){t.createVisible=e}}},[a("FlowDetailComponent",{ref:"flowdetail",attrs:{form:t.createParams}}),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.createVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.saveCreate}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"复制",visible:t.copyVisible,width:"30%"},on:{"update:visible":function(e){t.copyVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"flowKey"}},[a("el-input",{model:{value:t.copyParams.flow_key,callback:function(e){t.$set(t.copyParams,"flow_key",e)},expression:"copyParams.flow_key"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.copyVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.saveCopy}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"编辑",visible:t.editVisible,width:"30%"},on:{"update:visible":function(e){t.editVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.form,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"flow key"}},[a("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.editVisible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.saveEdit}},[t._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var f=a("VU/8")(c,d,!1,function(t){a("N2wG")},"data-v-79a37734",null);e.default=f.exports},WXBa:function(t,e){},bLri:function(t,e){},c5jA:function(t,e){},kc8X:function(t,e){}});
//# sourceMappingURL=1.13c7a80714d6c5413187.js.map